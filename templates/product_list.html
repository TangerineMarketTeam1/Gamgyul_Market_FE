<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product List</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Product List</h1>
    <ul id="product-list"></ul>

    <script>
        const API_BASE_URL = "http://127.0.0.1:8000/";

        async function fetchProducts() {
            try {
                const response = await fetch(`${API_BASE_URL}market/products/`);
                const data = await response.json();
                const products = data.results;

                // products 배열이 유효한지 확인
                if (!Array.isArray(products)) {
                    throw new Error("응답이 배열이 아닙니다.");
                }

                const productListElement = document.getElementById('product-list');
                products.forEach(product => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <h2><a href="./product_detail.html?id=${product.id}">${product.name}</a></h2>
                        <p>Price: ${product.price}원</p>
                        <p>Seller: ${product.user}</p>
                        <p>Stock: ${product.stock}</p>
                    `;
                    productListElement.appendChild(li); // DOM에 추가
                });
            } catch (error) {
                console.error('Error fetching products:', error);
            }
        }

        // 페이지 로드 시 상품 목록을 불러옴
        document.addEventListener('DOMContentLoaded', fetchProducts);
    </script>
</body>
</html>
